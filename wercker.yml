box: node:latest
workdir:
  steps:
    # Set wordir
    - WORKDIR /app
    # Copy src to workdir
    - COPY . /app/
build:
  steps:
    # Install latest npm version
    - script:
        name: install latest npm version
        code: npm install npm@latest -g
    # Install latest angular-cli
    - script:
        name: install latest angular-cli version
        code: npm install -g @angular/cli@latest --unsafe-perm
    # Install npm dependencies
    - script:
        name: install npm dependencies
        code: npm install --unsafe-perm
serve:
  steps:
    # Serve application
    - script:
        name: serve app
        code: ng serve --host 0.0.0.0 --port 8081
    # Expose port
    - script:
        name: expose port
        code: EXPOSE 8081
push:
  steps:
    # Push to public docker repo
    - internal/docker-push: 
        username: $USERNAME
        password: $PASSWORD
        repository: $USERNAME/test
        tag: latest 
